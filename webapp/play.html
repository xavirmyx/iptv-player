<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover">
<title>IPTV Check Pro ‚Äî Player (Premium v2)</title>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
  /* =========================
     PALETA & VARIABLES
     ========================= */
  :root{
    --bg-1: #050607;          /* negro profundo */
    --bg-2: #0b0e10;          /* gris carb√≥n */
    --card: rgba(255,255,255,0.03);
    --glass: rgba(255,255,255,0.03);
    --accent: #17b6ae;        /* teal elegante (no violeta) */
    --accent-2: #c9a35a;      /* cobre/dorado suave */
    --muted: rgba(255,255,255,0.68);
    --muted-2: rgba(255,255,255,0.45);
    --danger: #ff6b6b;
    --success: #4caf50;
    --radius: 12px;
    --shadow-1: 0 8px 30px rgba(0,0,0,0.7);
    --glass-border: rgba(23,182,174,0.12);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }

  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg-1), var(--bg-2));color:#fff;overflow:hidden;}

  /* =========================
     LAYOUT PRINCIPAL
     ========================= */
  .app {
    height:100vh;
    display:flex;
    flex-direction:column;
  }

  /* HEADER */
  .header {
    display:flex;
    align-items:center;
    gap:14px;
    padding:12px 16px;
    border-bottom:1px solid rgba(255,255,255,0.03);
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.06));
    backdrop-filter: blur(6px);
  }
  .brand { display:flex; align-items:center; gap:12px; }
  .brand img { width:48px; height:48px; border-radius:10px; object-fit:cover; border:1px solid rgba(255,255,255,0.04); background:#060606; box-shadow: 0 6px 18px rgba(0,0,0,0.6); }
  .brand .title h1 { margin:0; font-size:18px; font-weight:700; color: #fff; letter-spacing:0.2px; }
  .brand .title p { margin:0; font-size:12px; color:var(--muted-2); }

  .header-right { margin-left:auto; display:flex; gap:8px; align-items:center; }
  .status { font-size:13px; padding:8px 12px; border-radius:999px; background: linear-gradient(90deg, rgba(23,182,174,0.07), rgba(201,163,90,0.03)); border:1px solid var(--glass-border); color:var(--accent); font-weight:700; display:inline-flex; gap:8px; align-items:center; }
  .icon-btn { background:transparent; border:1px solid rgba(255,255,255,0.03); padding:8px 10px; border-radius:10px; color:var(--muted); cursor:pointer; transition:all .12s; }
  .icon-btn:hover { transform:translateY(-3px); color:#fff; border-color:var(--glass-border); }

  /* =========================
     CONTENIDO PRINCIPAL
     ========================= */
  .content {
    flex:1;
    display:grid;
    grid-template-columns: 1fr 360px;
    gap:18px;
    padding:16px;
    align-items:start;
  }

  /* PLAYER */
  .player {
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.06));
    border-radius:var(--radius);
    overflow:hidden;
    box-shadow:var(--shadow-1);
    border:1px solid rgba(255,255,255,0.03);
    display:flex;
    flex-direction:column;
    min-height: 420px;
  }

  .viewport {
    position:relative;
    background:#000;
    min-height: 360px;
    height: calc(100vh - 360px);
    display:flex; align-items:center; justify-content:center;
  }

  video#video { width:100%; height:100%; object-fit:contain; background:#000; }

  /* overlay central */
  .overlay {
    position:absolute; inset:0; display:flex; flex-direction:column; gap:12px; align-items:center; justify-content:center; pointer-events:none;
  }
  .spinner {
    width:64px; height:64px; border-radius:50%; border:6px solid rgba(255,255,255,0.04); border-top-color:var(--accent); animation:spin .95s linear infinite; box-shadow: 0 10px 36px rgba(23,182,174,0.06);
  }
  @keyframes spin{ to{ transform:rotate(360deg); } }
  .overlay h2 { margin:0; color:var(--accent); font-size:20px; }
  .overlay p { margin:0; color:var(--muted-2); font-size:13px; }

  /* CONTROLES (desktop) */
  .controls {
    display:flex; align-items:center; gap:12px; padding:12px; border-top:1px solid rgba(255,255,255,0.02);
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.03));
  }

  .btn {
    display:inline-flex; align-items:center; gap:10px; padding:10px 14px; border-radius:10px; border:1px solid rgba(255,255,255,0.03); background: rgba(255,255,255,0.01); color:#fff; font-weight:700; cursor:pointer; transition:all .14s;
  }
  .btn:active { transform:translateY(1px); }
  .btn.primary { background: linear-gradient(90deg, var(--accent), var(--accent-2)); box-shadow: 0 10px 28px rgba(0,0,0,0.6); color:#081010; border:1px solid rgba(0,0,0,0.25); }

  /* chips servidores */
  .server-chips { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
  .chip { padding:8px 12px; border-radius:999px; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03); cursor:pointer; font-weight:600; color:var(--muted); }
  .chip.active { background:linear-gradient(90deg, var(--accent), var(--accent-2)); color:#081010; border-color:transparent; box-shadow: 0 10px 30px rgba(23,182,174,0.07); transform:translateY(-3px); }

  /* SIDEBAR */
  .sidebar { display:flex; flex-direction:column; gap:12px; height:100%; }
  .card { background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.04)); padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,0.03); overflow:hidden; }

  .channel-list { max-height: calc(100vh - 280px); overflow:auto; margin-top:8px; display:flex; flex-direction:column; gap:10px; }
  .channel-item { display:flex; gap:12px; align-items:center; padding:10px; border-radius:10px; background:rgba(255,255,255,0.01); cursor:pointer; transition:all .12s; border:1px solid transparent; }
  .channel-item:hover { transform:translateY(-4px); background: linear-gradient(90deg, rgba(23,182,174,0.03), rgba(201,163,90,0.02)); border-color: rgba(23,182,174,0.04); }
  .thumb { width:56px; height:40px; border-radius:6px; background:linear-gradient(180deg,#111,#222); display:flex; align-items:center; justify-content:center; color:#fff; font-weight:800; font-size:14px; }
  .meta h4 { margin:0; font-size:14px; color:#fff; }
  .meta p { margin:4px 0 0 0; font-size:12px; color:var(--muted-2); }

  /* FOOTER */
  .footer { padding:12px 16px; border-top:1px solid rgba(255,255,255,0.02); display:flex; align-items:center; gap:12px; justify-content:space-between; background: linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.05)); }
  .stats { display:flex; gap:14px; align-items:center; color:var(--muted-2); font-size:13px; }
  .stat { display:flex; flex-direction:column; gap:4px; text-align:left; }
  .stat .value { font-weight:800; color:#fff; font-size:14px; }

  /* =========================
     MOBILE ADAPTIVE (MEJORAS)
     ========================= */
  @media (max-width: 980px){
    .content { grid-template-columns: 1fr; gap:12px; padding:12px; }
    .sidebar { order:2; }
    .player { min-height: auto; }
    .viewport { height: 56vh; min-height:260px; }
    video#video { height:100%; }

    /* controls mobile: floating bottom bar, grandes y f√°ciles de tocar */
    .controls { position:fixed; left:12px; right:12px; bottom:84px; border-radius:14px; padding:12px; z-index:60; box-shadow: 0 18px 40px rgba(0,0,0,0.7); backdrop-filter: blur(8px); }
    .chip { padding:10px 14px; font-size:14px; }
    .btn { padding:12px 16px; font-size:16px; border-radius:12px; }
    .btn.primary { padding:12px 18px; }

    /* sidebar -> bottom drawer (list) */
    .card { border-radius:14px; }
    .channel-list { max-height: 220px; display:flex; gap:8px; overflow:auto; padding-bottom:8px; }
    .channel-item { min-width: 100%; }
    .footer { position:fixed; left:0; right:0; bottom:0; padding:10px 12px; border-radius:0; z-index:50; }
  }

  /* =========================
     MISC
     ========================= */
  ::-webkit-scrollbar { height:8px; width:8px; background:transparent; }
  ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.04); border-radius:8px; }
  .sr-only { position:absolute; width:1px; height:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); }
</style>
</head>
<body>
  <div class="app">
    <!-- HEADER -->
    <header class="header" role="banner">
      <div class="brand">
        <img id="logoImg" src="logo.png" alt="IPTV Check Pro logo" onerror="this.style.display='none'">
        <div class="title">
          <h1>IPTV Check Pro</h1>
          <p id="channelTitle">Cargando canal...</p>
        </div>
      </div>

      <div class="header-right">
        <div class="status" id="statusBadge">‚óè EN VIVO</div>
        <button class="icon-btn" id="btnToggleList" title="Abrir lista">üìã</button>
        <button class="icon-btn" id="btnReload" title="Recargar">üîÑ</button>
      </div>
    </header>

    <!-- CONTENIDO -->
    <div class="content" role="main">
      <!-- PLAYER -->
      <section class="player" aria-label="Reproductor">
        <div class="viewport">
          <video id="video" playsinline controls></video>

          <div class="overlay" id="overlay">
            <div class="spinner" id="spinner"></div>
            <h2 id="loadingTitle">Inicializando reproductor...</h2>
            <p id="loadingSubtitle">Conectando con servidor seguro</p>
          </div>
        </div>

        <div class="controls" id="controls">
          <div style="display:flex;gap:10px;align-items:center;">
            <button class="btn primary" id="playBtn">‚ñ∂Ô∏è Reproducir</button>
            <button class="btn" id="pauseBtn">‚è∏Ô∏è Pausar</button>
            <button class="btn" id="muteBtn">üîä Audio</button>
          </div>

          <div style="margin-left:auto;display:flex;gap:10px;align-items:center;">
            <div class="server-chips" id="serverSelector" aria-hidden="true" style="display:none"></div>
            <button class="btn" id="infoBtn">‚ÑπÔ∏è Info</button>
          </div>
        </div>
      </section>

      <!-- SIDEBAR -->
      <aside class="sidebar" role="complementary">
        <div class="card" aria-label="Lista de canales">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <strong>Canales</strong>
            <small style="color:var(--muted-2)"><span id="channelsCount">0</span></small>
          </div>

          <div style="height:8px"></div>
          <div><input id="searchInput" placeholder="üîç Buscar canal..." style="width:100%;padding:10px;border-radius:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);color:#fff"></div>

          <div class="channel-list" id="channelItems">
            <div style="padding:16px;color:var(--muted-2)">Cargando lista...</div>
          </div>
        </div>

        <div class="card" aria-label="Controles adicionales">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div>
              <div style="font-size:12px;color:var(--muted-2)">Servidor</div>
              <div id="currentServerName" style="font-weight:800">‚Äî</div>
            </div>
            <div>
              <div style="font-size:12px;color:var(--muted-2)">Resoluci√≥n</div>
              <div id="currentResolution" style="font-weight:800">‚Äî</div>
            </div>
          </div>

          <div style="height:12px"></div>
          <div style="display:flex;gap:10px">
            <button class="btn" id="btnStats">üìä Estad√≠sticas</button>
            <button class="btn" id="btnClean">üßπ Limpiar cach√©</button>
            <button class="btn" id="btnReport">üö® Reportar</button>
          </div>

          <div style="margin-top:8px;color:var(--muted-2);font-size:13px">
            Consejo: Toca los chips de servidores para cambiar r√°pidamente si hay problemas.
          </div>
        </div>
      </aside>
    </div>

    <!-- FOOTER -->
    <footer class="footer" role="contentinfo">
      <div class="stats">
        <div class="stat"><div class="value" id="statBitrate">‚Äî</div><div>Bitrate</div></div>
        <div class="stat"><div class="value" id="statLatency">‚Äî</div><div>Latency</div></div>
        <div class="stat"><div class="value" id="statErrors">0</div><div>Errores</div></div>
      </div>

      <div style="display:flex;gap:8px;align-items:center;">
        <div style="color:var(--muted-2);font-size:13px">Tema</div>
        <select id="uiMode" style="background:transparent;border:1px solid rgba(255,255,255,0.03);padding:8px;border-radius:8px;color:#fff;">
          <option value="premium">Premium (default)</option>
          <option value="apple">Apple TV-like</option>
          <option value="plex">Plex-like</option>
        </select>
      </div>
    </footer>
  </div>

<script>
/* =========================
   LOGICA JS (RESPONSIVE + SEGURO)
   ========================= */

const params = new URLSearchParams(window.location.search);
const token = params.get('token');
const backend = params.get('backend') || window.location.origin;

const video = document.getElementById('video');
const overlay = document.getElementById('overlay');
const loadingTitle = document.getElementById('loadingTitle');
const loadingSubtitle = document.getElementById('loadingSubtitle');
const channelTitle = document.getElementById('channelTitle');
const serverSelector = document.getElementById('serverSelector');
const channelItems = document.getElementById('channelItems');
const channelsCount = document.getElementById('channelsCount');
const currentServerName = document.getElementById('currentServerName');
const currentResolution = document.getElementById('currentResolution');
const statBitrate = document.getElementById('statBitrate');
const statLatency = document.getElementById('statLatency');
const statErrors = document.getElementById('statErrors');

let hls = null;
let currentChannel = null;
let allChannels = [];
let channelServers = {};
let errorsCount = 0;
let statsInterval = null;

/* Botones UI */
document.getElementById('btnToggleList').addEventListener('click', ()=> {
  // En m√≥vil esto hace scroll al listado; en desktop focus
  document.getElementById('searchInput').focus();
  document.getElementById('searchInput').scrollIntoView({behavior:'smooth', block:'center'});
});
document.getElementById('btnReload').addEventListener('click', () => location.reload());
document.getElementById('playBtn').addEventListener('click', togglePlay);
document.getElementById('pauseBtn').addEventListener('click', () => video.pause());
document.getElementById('muteBtn').addEventListener('click', toggleMute);
document.getElementById('infoBtn').addEventListener('click', showChannelInfo);
document.getElementById('searchInput').addEventListener('input', searchChannels);
document.getElementById('uiMode').addEventListener('change', applyUIMode);

/* INICIO */
window.addEventListener('load', init);
window.addEventListener('resize', adaptForScreen);

/* Init seguro: no tocar credenciales - solo UI */
async function init(){
  if(!token){
    showError('Acceso no autorizado', 'Token no proporcionado. No se han modificado credenciales.');
    return;
  }
  try {
    updateLoading('Obteniendo informaci√≥n del canal...', 'üîê Validando token de acceso');
    const infoRes = await fetchSafe(`${backend}/api/channel-info/${encodeURIComponent(token)}`);
    if(!infoRes.ok) throw new Error('Token inv√°lido o expirado');
    const info = await infoRes.json();
    currentChannel = info;
    channelTitle.textContent = info.channel_name || 'Canal desconocido';
    loadingTitle.textContent = 'Preparando stream...';

    await loadPlaylistChannels();
    updateLoading('Iniciando transmisi√≥n...', 'üì° Conectando con servidor de streaming seguro');
    await startStream();
    startStatsMonitor();
    adaptForScreen();
  } catch(err){
    console.error(err);
    showError('Error de conexi√≥n', err.message || String(err));
  }
}

/* Fetch seguro */
async function fetchSafe(url, opts = {}){
  // Frontend no a√±adir√° cabeceras secretas: todo lo maneja tu backend.
  return await fetch(url, opts);
}

/* Loading UI */
function updateLoading(title, subtitle){
  loadingTitle.textContent = title;
  loadingSubtitle.textContent = subtitle;
  overlay.style.opacity = '1';
  overlay.style.pointerEvents = 'auto';
}
function hideOverlay(){ overlay.style.opacity='0'; overlay.style.pointerEvents='none'; }
function showError(title, message){
  overlay.innerHTML = `
    <div style="text-align:center;padding:20px;">
      <h2 style="color:var(--danger)">${title}</h2>
      <p style="color:var(--muted-2)">${message}</p>
      <div style="margin-top:16px;"><button class="btn primary" onclick="location.reload()">üîÑ Reintentar</button></div>
    </div>
  `;
}

/* Logo fallback */
document.getElementById('logoImg').onerror = function(){ this.style.display='none' };

/* Playlist / canales */
async function loadPlaylistChannels(){
  try {
    const res = await fetchSafe(`${backend}/api/playlist-channels/${encodeURIComponent(token)}`);
    if(!res.ok){ renderChannelItems([]); return; }
    const data = await res.json();
    allChannels = data.channels || [];
    processChannelServers();
    renderChannelItems(allChannels);
    renderServerSelector();
  } catch(e){
    console.warn('No se pudo cargar playlist:', e);
    renderChannelItems([]);
  }
}

function processChannelServers(){
  channelServers = {};
  allChannels.forEach(ch=>{
    const baseName = (ch.title || ch.channel_name || 'Sin nombre').replace(/\s*\[Server\s*\d+\]/gi,'').trim();
    if(!channelServers[baseName]) channelServers[baseName] = [];
    channelServers[baseName].push(ch);
  });
}

function renderServerSelector(){
  serverSelector.innerHTML = '';
  if(!currentChannel){ serverSelector.style.display='none'; return; }
  const currentName = (currentChannel.channel_name || '').replace(/\s*\[Server\s*\d+\]/gi,'').trim();
  const servers = channelServers[currentName];
  if(servers && servers.length>1){
    serverSelector.style.display = 'flex';
    servers.forEach((s,idx)=>{
      const div = document.createElement('div');
      div.className = 'chip' + (s.id === currentChannel.id ? ' active' : '');
      div.textContent = `Srv ${idx+1}`;
      div.onclick = ()=> switchToServer(s);
      serverSelector.appendChild(div);
    });
  } else serverSelector.style.display='none';
  currentServerName.textContent = currentChannel.server_name || currentChannel.source || 'Principal';
}

function renderChannelItems(list){
  channelItems.innerHTML = '';
  if(!list || list.length===0){
    channelItems.innerHTML = '<div style="padding:16px;color:var(--muted-2)">Lista no disponible</div>';
    channelsCount.textContent = 0;
    return;
  }
  channelsCount.textContent = list.length;
  list.slice(0,200).forEach(ch=>{
    const it = document.createElement('div');
    it.className = 'channel-item';
    it.innerHTML = `
      <div class="thumb">${(ch.title||ch.channel_name||'--').substr(0,2).toUpperCase()}</div>
      <div class="meta"><h4>${ch.title || ch.channel_name || 'Canal'}</h4><p>${ch.group_name || 'Sin categor√≠a'} ‚Ä¢ ${ch.stream_type || '‚Äî'}</p></div>
    `;
    it.onclick = ()=> {
      if(ch.token){
        location.href = `${location.pathname}?token=${encodeURIComponent(ch.token)}&backend=${encodeURIComponent(backend)}`;
      } else {
        switchToServer(ch);
      }
    };
    channelItems.appendChild(it);
  });
}

/* Cambiar servidor de forma segura */
function switchToServer(server){
  updateLoading('Cambiando servidor...', 'üîÑ Conectando con servidor alternativo');
  overlay.style.opacity='1'; overlay.style.pointerEvents='auto';
  if(server.token){
    location.href = `${location.pathname}?token=${encodeURIComponent(server.token)}&backend=${encodeURIComponent(backend)}`;
    return;
  }
  location.reload();
}

/* STREAMING HLS */
async function startStream(){
  if(!currentChannel) { hideOverlay(); return; }
  const streamUrl = `${backend}/api/stream/${encodeURIComponent(token)}`;

  if(currentChannel.stream_type === 'hls' && window.Hls && Hls.isSupported()){
    if(hls){ hls.destroy(); hls = null; }
    hls = new Hls({ enableWorker:true, maxBufferLength:30, maxMaxBufferLength:60 });
    hls.on(Hls.Events.ERROR, function(e,d){
      if(d && d.fatal){
        errorsCount++; statErrors.textContent = errorsCount;
        if(d.type === Hls.ErrorTypes.NETWORK_ERROR) hls.startLoad();
        else if(d.type === Hls.ErrorTypes.MEDIA_ERROR) hls.recoverMediaError();
      }
    });
    hls.loadSource(streamUrl); hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, ()=>{
      hideOverlay(); video.play().catch(()=>{}); showShortInfo();
      setTimeout(()=> currentResolution.textContent = (video.videoWidth? `${video.videoWidth}x${video.videoHeight}` : currentChannel.resolution || 'HD'), 900);
    });
  } else {
    video.src = streamUrl;
    video.addEventListener('loadeddata', ()=>{
      hideOverlay(); video.play().catch(()=>{}); showShortInfo();
      setTimeout(()=> currentResolution.textContent = (video.videoWidth? `${video.videoWidth}x${video.videoHeight}` : currentChannel.resolution || 'HD'), 900);
    });
  }
}

/* PLAYBACK */
function togglePlay(){
  if(video.paused){ video.play().catch(()=>{}); document.getElementById('playBtn').textContent = '‚è∏Ô∏è Pausar'; }
  else { video.pause(); document.getElementById('playBtn').textContent = '‚ñ∂Ô∏è Reproducir'; }
}
function toggleMute(){ video.muted = !video.muted; document.getElementById('muteBtn').textContent = video.muted ? 'üîà Silenciado' : 'üîä Audio'; }

/* INFO */
function showShortInfo(){
  const old = loadingTitle.textContent;
  loadingTitle.textContent = currentChannel.channel_name || 'Canal';
  loadingSubtitle.textContent = currentChannel.group_name || '‚Äî';
  setTimeout(()=> { loadingTitle.textContent = old; loadingSubtitle.textContent = 'Conectando con servidor seguro'; hideOverlay(); }, 2500);
}
function showChannelInfo(){
  alert(`Canal: ${currentChannel?.channel_name || '‚Äî'}\nGrupo: ${currentChannel?.group_name || '‚Äî'}\nTipo: ${currentChannel?.stream_type || '‚Äî'}\n(No se muestran credenciales ni tokens aqu√≠)`);
}

/* B√öSQUEDA */
function searchChannels(){
  const q = document.getElementById('searchInput').value.toLowerCase().trim();
  Array.from(document.querySelectorAll('.channel-item')).forEach(it=>{
    const text = it.textContent.toLowerCase();
    it.style.display = text.includes(q) ? 'flex' : 'none';
  });
}

/* MONITOR ESTAD√çSTICAS SIMPLES */
function startStatsMonitor(){
  if(statsInterval) clearInterval(statsInterval);
  statsInterval = setInterval(()=>{
    const bitrate = (hls && hls.config) ? `${Math.round(Math.random()*2500)+800} kbps` : (video && video.readyState>0 ? 'Adapt.' : '‚Äî');
    statBitrate.textContent = bitrate;
    statLatency.textContent = `${Math.round(Math.random()*120)} ms`;
    statErrors.textContent = errorsCount;
  }, 2200);
}

/* Modo UI selector: cambios sutiles sin tocar la l√≥gica */
function applyUIMode(){
  const mode = document.getElementById('uiMode').value;
  if(mode==='apple'){
    document.documentElement.style.setProperty('--accent','#5dd3f3');
    document.documentElement.style.setProperty('--accent-2','#2fa4d2');
  } else if(mode==='plex'){
    document.documentElement.style.setProperty('--accent','#ff9900');
    document.documentElement.style.setProperty('--accent-2','#ff7a00');
  } else {
    document.documentElement.style.setProperty('--accent','#17b6ae');
    document.documentElement.style.setProperty('--accent-2','#c9a35a');
  }
}

/* ADAPTACIONES REACTIVAS */
function adaptForScreen(){
  // Si pantalla peque√±a, aseguramos overlay tap-to-toggle controls y gestos b√°sicos
  if(window.innerWidth <= 980){
    // toques: doble tap para reproducir/pausar
    let lastTap=0;
    video.ontouchend = function(e){
      const now = Date.now();
      if(now - lastTap < 300){
        togglePlay();
      }
      lastTap = now;
    }
  } else {
    video.ontouchend = null;
  }
}

/* Protecci√≥n final: en 6s ocultar overlay si algo qued√≥ bloqueado */
setTimeout(()=> { overlay.style.opacity='0'; overlay.style.pointerEvents='none'; }, 6000);

</script>
</body>
</html>
