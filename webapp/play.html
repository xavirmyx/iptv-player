<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>IPTV Check Pro ‚Äî Player (Premium)</title>

<!-- hls.js -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
  :root{
    --bg-1: #08080a;
    --bg-2: #0f1113;
    --glass: rgba(255,255,255,0.04);
    --accent: #6d7df0; /* morado-azulado */
    --accent-2: #8a6ef2;
    --muted: rgba(255,255,255,0.65);
    --card: rgba(255,255,255,0.03);
    --success: #4caf50;
    --danger: #ff6b6b;
    --radius: 12px;
    --shadow-1: 0 6px 24px rgba(0,0,0,0.7);
    --glass-border: rgba(109,125,240,0.12);
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  html,body{
    height:100%;
    margin:0;
    background: linear-gradient(180deg,var(--bg-1), var(--bg-2));
    color: #fff;
    overflow:hidden;
  }

  /* Layout */
  .app {
    height:100vh;
    display:grid;
    grid-template-rows:72px 1fr 120px;
    gap: 10px;
  }

  /* Header */
  .header {
    display:flex;
    align-items:center;
    gap:16px;
    padding:12px 20px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.12));
    border-bottom: 1px solid rgba(255,255,255,0.03);
    box-shadow: var(--shadow-1);
    backdrop-filter: blur(8px);
  }
  .brand {
    display:flex;
    align-items:center;
    gap:14px;
  }
  .brand img {
    width:52px;
    height:52px;
    border-radius:10px;
    object-fit:cover;
    box-shadow: 0 6px 18px rgba(0,0,0,0.6);
    border:1px solid var(--glass-border);
    background:linear-gradient(180deg,#0b0b0d,#141417);
  }
  .brand .title {
    display:flex;
    flex-direction:column;
    line-height:1;
  }
  .brand .title h1 {
    font-size:18px;
    margin:0;
    font-weight:700;
    letter-spacing:0.2px;
    background: linear-gradient(90deg,var(--accent), var(--accent-2));
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
  }
  .brand .title p {
    margin:0;
    font-size:12px;
    color:var(--muted);
  }

  .header-right {
    margin-left:auto;
    display:flex;
    gap:10px;
    align-items:center;
  }
  .status {
    font-size:13px;
    padding:8px 12px;
    border-radius:999px;
    background:linear-gradient(90deg, rgba(109,125,240,0.12), rgba(138,110,242,0.07));
    border:1px solid var(--glass-border);
    color:var(--accent);
    display:inline-flex;
    align-items:center;
    gap:8px;
    font-weight:600;
  }
  .mini-btn {
    background:transparent;
    border:1px solid rgba(255,255,255,0.04);
    padding:8px 12px;
    border-radius:10px;
    color:var(--muted);
    cursor:pointer;
    backdrop-filter: blur(6px);
  }
  .mini-btn:hover { transform: translateY(-3px); border-color: var(--glass-border); color:#fff; }

  /* Main: player + sidebar */
  .main {
    display:grid;
    grid-template-columns: 1fr 360px;
    gap:18px;
    padding: 16px 20px;
    align-items:stretch;
  }

  /* Player Card */
  .player-card {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.14));
    border-radius: var(--radius);
    overflow:hidden;
    box-shadow: var(--shadow-1);
    border:1px solid rgba(255,255,255,0.03);
    display:flex;
    flex-direction:column;
  }
  .player-top {
    position:relative;
    height: calc(100vh - 260px);
    min-height: 360px;
    background: #000;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  video#video{
    width:100%;
    height:100%;
    background:#000;
    object-fit:contain;
  }

  /* Player overlay */
  .player-overlay {
    position:absolute;
    inset:0;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    pointer-events:none;
  }
  .loader {
    width:68px;
    height:68px;
    border-radius:50%;
    border:6px solid rgba(255,255,255,0.06);
    border-top-color: var(--accent);
    animation: spin 1s linear infinite;
    box-shadow: 0 8px 24px rgba(109,125,240,0.12);
    pointer-events:none;
  }
  @keyframes spin { to { transform:rotate(360deg); } }

  .player-info {
    margin-top:18px;
    text-align:center;
    color:var(--muted);
  }
  .player-info h2 { margin:0; color:var(--accent); font-size:20px; }
  .player-info p { margin:6px 0 0 0; font-size:13px; color: rgba(255,255,255,0.65); }

  /* Controls bottom */
  .player-controls {
    padding:14px;
    display:flex;
    align-items:center;
    gap:12px;
    border-top:1px solid rgba(255,255,255,0.02);
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.04));
  }

  .btn {
    display:inline-flex;
    align-items:center;
    gap:10px;
    padding:10px 16px;
    border-radius:10px;
    border:1px solid rgba(255,255,255,0.04);
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.08));
    color: #fff;
    cursor:pointer;
    font-weight:600;
    transition: all .18s ease;
  }
  .btn:hover { transform: translateY(-4px); box-shadow: 0 10px 28px rgba(0,0,0,0.6); border-color: var(--glass-border); }
  .btn.primary {
    background: linear-gradient(90deg,var(--accent), var(--accent-2));
    border:1px solid rgba(0,0,0,0.25);
    color:#fff;
    box-shadow: 0 8px 30px rgba(109,125,240,0.12);
  }

  /* Server chips */
  .servers {
    display:flex;
    gap:8px;
    align-items:center;
    flex-wrap:wrap;
  }
  .chip {
    padding:8px 12px;
    border-radius:999px;
    background: rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.03);
    font-size:13px;
    cursor:pointer;
    transition: all .14s;
  }
  .chip.active {
    background: linear-gradient(90deg,var(--accent), var(--accent-2));
    color:#fff;
    border-color: transparent;
    transform: translateY(-3px);
  }

  /* Right sidebar */
  .sidebar {
    display:flex;
    flex-direction:column;
    gap:12px;
    height:100%;
  }
  .card {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
    border-radius:12px;
    padding:12px;
    border:1px solid rgba(255,255,255,0.03);
  }

  .channels-header {
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
  }
  .channels-search input {
    width:100%;
    padding:10px 12px;
    border-radius:10px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.04);
    color:#fff;
    outline:none;
  }

  .channels-list {
    max-height: calc(100vh - 360px);
    overflow:auto;
    margin-top:8px;
    display:grid;
    gap:10px;
  }

  .channel-item {
    display:flex;
    gap:12px;
    align-items:center;
    padding:10px;
    border-radius:10px;
    cursor:pointer;
    transition: all .12s;
    border:1px solid transparent;
    background: rgba(255,255,255,0.02);
  }
  .channel-item:hover {
    transform: translateY(-4px);
    background: linear-gradient(90deg, rgba(109,125,240,0.04), rgba(138,110,242,0.02));
    border-color: rgba(109,125,240,0.06);
  }
  .channel-thumb {
    width:56px;
    height:40px;
    border-radius:6px;
    background:linear-gradient(180deg,#111,#222);
    flex-shrink:0;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    color:#fff;
    border:1px solid rgba(0,0,0,0.4);
  }
  .channel-meta h4 { margin:0; font-size:14px; }
  .channel-meta p { margin:4px 0 0 0; font-size:12px; color:var(--muted); }

  /* Footer: detailed controls and stats */
  .footer {
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding:14px 20px;
    border-top:1px solid rgba(255,255,255,0.02);
    background: linear-gradient(180deg, rgba(0,0,0,0.06), rgba(0,0,0,0.12));
  }

  .stats {
    display:flex;
    gap:14px;
    align-items:center;
  }
  .stat {
    display:flex;
    flex-direction:column;
    font-size:12px;
    color:var(--muted);
  }
  .stat .value { font-weight:700; color:#fff; font-size:14px; }

  /* Small screens */
  @media (max-width: 980px){
    .main { grid-template-columns: 1fr; padding:12px; }
    .sidebar { order:2; }
    .player-top { height: 55vh; min-height: 320px; }
    .channels-list { max-height: 220px; }
  }
</style>
</head>
<body>
  <div class="app" id="app">
    <!-- HEADER -->
    <header class="header">
      <div class="brand">
        <!-- logo.png must be in same folder; if not, reemplazar ruta -->
        <img id="logoImg" src="logo.png" alt="IPTV Check Pro Logo" onerror="this.style.display='none'">
        <div class="title">
          <h1>IPTV Check Pro</h1>
          <p id="channelTitle">Cargando canal...</p>
        </div>
      </div>

      <div class="header-right">
        <div class="status" id="statusBadge">‚óè EN VIVO</div>
        <button class="mini-btn" id="btnToggleList" title="Abrir lista">üìã Canales</button>
        <button class="mini-btn" id="btnReload" title="Recargar">üîÑ</button>
      </div>
    </header>

    <!-- MAIN -->
    <main class="main">
      <!-- PLAYER -->
      <section class="player-card" aria-label="Reproductor">
        <div class="player-top">
          <video id="video" playsinline controls></video>

          <div class="player-overlay" id="overlay">
            <div class="loader" id="loader"></div>
            <div class="player-info">
              <h2 id="loadingTitle">Inicializando reproductor...</h2>
              <p id="loadingSubtitle">Conectando con servidor seguro</p>
            </div>
          </div>
        </div>

        <div class="player-controls">
          <div style="display:flex;gap:10px;align-items:center;">
            <button class="btn primary" id="playBtn">‚ñ∂Ô∏è Reproducir</button>
            <button class="btn" id="pauseBtn">‚è∏Ô∏è Pausar</button>
            <button class="btn" id="muteBtn">üîä Audio</button>
          </div>

          <div style="margin-left:auto; display:flex; align-items:center; gap:12px;">
            <div class="servers" id="serverSelector" aria-hidden="true" style="display:none;"></div>
            <button class="btn" id="infoBtn">‚ÑπÔ∏è Info</button>
          </div>
        </div>
      </section>

      <!-- SIDEBAR -->
      <aside class="sidebar">
        <div class="card">
          <div class="channels-header">
            <strong>Canales disponibles</strong>
            <small style="color:var(--muted)"><span id="channelsCount">0</span></small>
          </div>

          <div style="height:10px"></div>

          <div class="channels-search">
            <input type="search" id="searchInput" placeholder="üîç Buscar canal o grupo..." />
          </div>

          <div class="channels-list" id="channelItems" role="list">
            <!-- items din√°micos -->
            <div style="padding:18px;color:var(--muted);font-size:13px">Cargando lista...</div>
          </div>
        </div>

        <div class="card" style="display:flex;flex-direction:column;gap:10px;">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div>
              <div style="font-size:13px;color:var(--muted)">Servidor actual</div>
              <div id="currentServerName" style="font-weight:700">‚Äî</div>
            </div>
            <div style="text-align:right">
              <div style="font-size:12px;color:var(--muted)">Resoluci√≥n</div>
              <div id="currentResolution" style="font-weight:700">‚Äî</div>
            </div>
          </div>

          <div style="display:flex;gap:10px;align-items:center;">
            <button class="btn" id="btnStats">üìä Estad√≠sticas</button>
            <button class="btn" id="btnClean">üßπ Limpiar cach√©</button>
            <button class="btn" id="btnReport">üö® Reportar</button>
          </div>

          <div style="font-size:12px;color:var(--muted);margin-top:4px;">
            Consejo: usa los chips de servidores para cambiar r√°pido si un stream falla.
          </div>
        </div>
      </aside>
    </main>

    <!-- FOOTER -->
    <footer class="footer">
      <div class="stats">
        <div class="stat"><div class="value" id="statBitrate">‚Äî</div><div>Bitrate</div></div>
        <div class="stat"><div class="value" id="statLatency">‚Äî</div><div>Latency</div></div>
        <div class="stat"><div class="value" id="statErrors">0</div><div>Errores</div></div>
      </div>

      <div style="display:flex;gap:10px;align-items:center;">
        <div style="font-size:13px;color:var(--muted)">Modo</div>
        <select id="uiMode" style="background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:8px;color:#fff;">
          <option value="premium">Premium (default)</option>
          <option value="apple">Apple TV-like</option>
          <option value="plex">Plex-like</option>
        </select>
      </div>
    </footer>
  </div>

<script>
/*
  Versi√≥n mejorada del player:
  - Mantiene param 'token' y 'backend' para no alterar autenticaci√≥n.
  - No cambia credenciales: todas las llamadas siguen a /api/... del backend dado.
  - Integra logo.png (si no existe, se oculta).
  - Uso m√≠nimo de DOM y manejo de errores.
*/

const params = new URLSearchParams(window.location.search);
const token = params.get('token');
const backend = params.get('backend') || window.location.origin;

const video = document.getElementById('video');
const overlay = document.getElementById('overlay');
const loader = document.getElementById('loader');
const loadingTitle = document.getElementById('loadingTitle');
const loadingSubtitle = document.getElementById('loadingSubtitle');
const channelTitle = document.getElementById('channelTitle');
const serverSelector = document.getElementById('serverSelector');
const channelItems = document.getElementById('channelItems');
const channelsCount = document.getElementById('channelsCount');
const currentServerName = document.getElementById('currentServerName');
const currentResolution = document.getElementById('currentResolution');
const statBitrate = document.getElementById('statBitrate');
const statLatency = document.getElementById('statLatency');
const statErrors = document.getElementById('statErrors');

let hls = null;
let currentChannel = null;
let allChannels = [];
let channelServers = {};
let errorsCount = 0;
let statsInterval = null;

// UI buttons
document.getElementById('btnToggleList').addEventListener('click', () => {
  document.querySelector('.sidebar').scrollIntoView({behavior:'smooth'});
});
document.getElementById('btnReload').addEventListener('click', () => location.reload());
document.getElementById('playBtn').addEventListener('click', togglePlay);
document.getElementById('pauseBtn').addEventListener('click', () => video.pause());
document.getElementById('muteBtn').addEventListener('click', toggleMute);
document.getElementById('infoBtn').addEventListener('click', showChannelInfo);
document.getElementById('searchInput').addEventListener('input', searchChannels);
document.getElementById('uiMode').addEventListener('change', applyUIMode);

// init
window.addEventListener('load', init);

async function init(){
  if(!token){
    showError('Acceso no autorizado','Token no proporcionado. No se cambiaron credenciales ni datos.');
    return;
  }
  try {
    loadLogoSafety();
    updateLoading('Obteniendo informaci√≥n del canal...', 'üîê Validando token de acceso');
    const infoRes = await fetchSafe(`${backend}/api/channel-info/${encodeURIComponent(token)}`);
    if(!infoRes.ok) throw new Error('Token inv√°lido o expirado');
    const info = await infoRes.json();
    // no manipular credenciales; solo UI
    currentChannel = info;
    channelTitle.textContent = info.channel_name || 'Canal desconocido';
    document.getElementById('loadingTitle').textContent = 'Preparando stream...';

    // load playlist (canales)
    await loadPlaylistChannels();

    // start stream
    updateLoading('Iniciando transmisi√≥n...', 'üì° Conectando con servidor de streaming seguro');
    await startStream();

    startStatsMonitor();
  } catch(err){
    console.error(err);
    showError('Error de conexi√≥n', err.message || String(err));
  }
}

/* Safe fetch helper: respects same-origin or provided backend ‚Äî no credentials leaked. */
async function fetchSafe(url, opts = {}){
  // do not attach any global secrets here.
  return await fetch(url, opts);
}

function updateLoading(title, subtitle){
  loadingTitle.textContent = title;
  loadingSubtitle.textContent = subtitle;
  overlay.style.opacity = '1';
  overlay.style.pointerEvents = 'auto';
}

function hideOverlay(){
  overlay.style.opacity = '0';
  overlay.style.pointerEvents = 'none';
}

function showError(title, message){
  overlay.innerHTML = `
    <div style="text-align:center;padding:20px;">
      <h2 style="color:var(--danger);">${title}</h2>
      <p style="color:var(--muted)">${message}</p>
      <div style="margin-top:16px;"><button class="btn primary" onclick="location.reload()">üîÑ Reintentar</button></div>
    </div>
  `;
}

function loadLogoSafety(){
  const logo = document.getElementById('logoImg');
  if(!logo) return;
  // logo est√° en el mismo folder. Si falla, se oculta: no se toca nada sensible.
  logo.onerror = () => logo.style.display = 'none';
}

async function loadPlaylistChannels(){
  try {
    const res = await fetchSafe(`${backend}/api/playlist-channels/${encodeURIComponent(token)}`);
    if(!res.ok) {
      // no es cr√≠tico; seguimos con canal actual
      renderChannelItems([]);
      return;
    }
    const data = await res.json();
    allChannels = data.channels || [];
    processChannelServers();
    renderChannelItems(allChannels);
    renderServerSelector();
  } catch(e){
    console.warn('No se pudo cargar playlist:', e);
    renderChannelItems([]);
  }
}

function processChannelServers(){
  channelServers = {};
  allChannels.forEach(ch=>{
    const baseName = (ch.title || ch.channel_name || 'Sin nombre').replace(/\s*\[Server\s*\d+\]/gi,'').trim();
    if(!channelServers[baseName]) channelServers[baseName] = [];
    channelServers[baseName].push(ch);
  });
}

function renderServerSelector(){
  serverSelector.innerHTML = '';
  if(!currentChannel) { serverSelector.style.display = 'none'; return; }
  const currentName = (currentChannel.channel_name || '').replace(/\s*\[Server\s*\d+\]/gi,'').trim();
  const servers = channelServers[currentName];
  if(servers && servers.length>1){
    serverSelector.style.display = 'flex';
    servers.forEach((s, idx)=>{
      const btn = document.createElement('div');
      btn.className = 'chip' + (s.id === currentChannel.id ? ' active' : '');
      btn.textContent = `Servidor ${idx+1}`;
      btn.onclick = () => switchToServer(s);
      serverSelector.appendChild(btn);
    });
  } else {
    serverSelector.style.display = 'none';
  }
  // show current server name
  currentServerName.textContent = currentChannel.server_name || currentChannel.source || 'Servidor principal';
}

function renderChannelItems(list){
  channelItems.innerHTML = '';
  if(!list || list.length===0){
    channelItems.innerHTML = '<div style="padding:18px;color:var(--muted)">Lista no disponible</div>';
    channelsCount.textContent = 0;
    return;
  }
  channelsCount.textContent = list.length;
  // group by base name; show first 40
  list.slice(0,200).forEach(ch=>{
    const item = document.createElement('div');
    item.className = 'channel-item';
    item.innerHTML = `
      <div class="channel-thumb" aria-hidden="true">${(ch.title||ch.channel_name||'--').substr(0,2).toUpperCase()}</div>
      <div class="channel-meta">
        <h4>${ch.title || ch.channel_name || 'Canal sin nombre'}</h4>
        <p>${ch.group_name || 'Sin categor√≠a'} ‚Ä¢ ${ch.stream_type || '‚Äî'}</p>
      </div>
    `;
    item.onclick = () => {
      // switch token/stream to that channel if token available or channel.token
      if(ch.token){
        // Change page token (keeps backend same): NO se tocan credenciales, solo navega a token nuevo
        location.href = `${location.pathname}?token=${encodeURIComponent(ch.token)}&backend=${encodeURIComponent(backend)}`;
      } else {
        // fallback: try switching by id (depends de tu backend)
        switchToServer(ch);
      }
    };
    channelItems.appendChild(item);
  });
}

/* Switch to server/channel (safe reload) */
function switchToServer(server){
  updateLoading('Cambiando servidor...', 'üîÑ Conectando con servidor alternativo');
  overlay.style.opacity = '1';
  overlay.style.pointerEvents = 'auto';
  // si el objeto contiene token, reusar token. Esto no modifica credenciales.
  if(server.token){
    location.href = `${location.pathname}?token=${encodeURIComponent(server.token)}&backend=${encodeURIComponent(backend)}`;
    return;
  }
  // si no hay token, intentar recargar el stream con otro endpoint (depende backend)
  // como fallback, recargamos la p√°gina (no tocamos datos)
  location.reload();
}

/* STREAM */
async function startStream(){
  if(!currentChannel) {
    hideOverlay();
    return;
  }
  const streamUrl = `${backend}/api/stream/${encodeURIComponent(token)}`;

  if (currentChannel.stream_type === 'hls' && Hls && Hls.isSupported()) {
    if(hls) {
      hls.destroy();
      hls = null;
    }
    hls = new Hls({ enableWorker:true, maxBufferLength:30, maxMaxBufferLength:60 });
    hls.on(Hls.Events.ERROR, function(event,data){
      if(data && data.fatal){
        errorsCount++;
        statErrors.textContent = errorsCount;
        if(data.type === Hls.ErrorTypes.NETWORK_ERROR) {
          hls.startLoad();
        } else if(data.type === Hls.ErrorTypes.MEDIA_ERROR){
          hls.recoverMediaError();
        } else {
          // fallback reload stream
        }
      }
    });
    hls.loadSource(streamUrl);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, function(){
      hideOverlay();
      video.play().catch(()=>{});
      showChannelShortInfo();
      // try to detect resolution
      setTimeout(()=> {
        currentResolution.textContent = video.videoWidth ? `${video.videoWidth}x${video.videoHeight}` : 'HD';
      }, 800);
    });
  } else {
    // normal progressive
    video.src = streamUrl;
    video.addEventListener('loadeddata', () => {
      hideOverlay();
      video.play().catch(()=>{});
      showChannelShortInfo();
    });
  }

  // display current server name/resolution if available
  currentServerName.textContent = currentChannel.server_name || currentChannel.source || 'Principal';
  currentResolution.textContent = currentChannel.resolution || 'HD';
}

/* Playback controls */
function togglePlay(){
  if(video.paused){
    video.play().catch(()=>{});
    document.getElementById('playBtn').textContent = '‚è∏Ô∏è Pausar';
  } else {
    video.pause();
    document.getElementById('playBtn').textContent = '‚ñ∂Ô∏è Reproducir';
  }
}
function toggleMute(){
  video.muted = !video.muted;
  document.getElementById('muteBtn').textContent = video.muted ? 'üîà Silenciado' : 'üîä Audio';
}

function showChannelShortInfo(){
  // Flash info briefly
  const old = document.getElementById('loadingTitle').textContent;
  loadingTitle.textContent = currentChannel.channel_name || 'Canal';
  loadingSubtitle.textContent = currentChannel.group_name || '‚Äî';
  setTimeout(()=> {
    loadingTitle.textContent = old;
    loadingSubtitle.textContent = 'Conectando con servidor seguro';
    hideOverlay();
  }, 3000);
}

/* Search */
function searchChannels(){
  const q = document.getElementById('searchInput').value.toLowerCase().trim();
  Array.from(document.querySelectorAll('.channel-item')).forEach(it=>{
    const text = it.textContent.toLowerCase();
    it.style.display = text.includes(q) ? 'flex' : 'none';
  });
}

/* UI mode switcher to emulate Apple/Plex look (visual tweaks) */
function applyUIMode(){
  const mode = document.getElementById('uiMode').value;
  if(mode === 'apple'){
    document.documentElement.style.setProperty('--accent', '#5dd3f3');
    document.documentElement.style.setProperty('--accent-2', '#2fa4d2');
    document.querySelectorAll('.btn.primary').forEach(b=> b.style.borderRadius = '14px');
  } else if(mode === 'plex'){
    document.documentElement.style.setProperty('--accent', '#ff9900');
    document.documentElement.style.setProperty('--accent-2', '#ff7a00');
    document.querySelectorAll('.btn.primary').forEach(b=> b.style.borderRadius = '8px');
  } else {
    // premium default
    document.documentElement.style.setProperty('--accent', '#6d7df0');
    document.documentElement.style.setProperty('--accent-2', '#8a6ef2');
  }
}

/* Periodic stats monitor (bitrate/latency simulation) */
function startStatsMonitor(){
  if(statsInterval) clearInterval(statsInterval);
  statsInterval = setInterval(()=> {
    // If using HLS, we could read hls.bufferInfo etc. For demo, show placeholders that update.
    const simulatedBitrate = hls && hls.config ? Math.round((Math.random()*2500)+800) + ' kbps' : (video && video.readyState>0 ? 'Adaptive' : '‚Äî');
    statBitrate.textContent = simulatedBitrate;
    statLatency.textContent = Math.round(Math.random()*120) + ' ms';
    statErrors.textContent = errorsCount;
  }, 2500);
}

/* Generic info modal (simple) */
function showChannelInfo(){
  alert(`Canal: ${currentChannel?.channel_name || '‚Äî'}\nGrupo: ${currentChannel?.group_name || '‚Äî'}\nTipo: ${currentChannel?.stream_type || '‚Äî'}\nNo se muestran credenciales ni tokens aqu√≠.`);
}

/* ensure overlay hides if stream loads from cache or quick */
setTimeout(()=> { overlay.style.opacity='0'; overlay.style.pointerEvents='none'; }, 6000);

</script>

</body>
</html>
